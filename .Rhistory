devtools::install_github('usstudiescentre/ussc')
load("~/dropboxsydneyuni/ussc au-us/data/survey_long_data.rdata")
load("~/dropboxsydneyuni/ussc Au-Us/analysis/data/survey_long_data.rdata")
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
tidyr::drop_na(..., answer) %>%
dplyr::group_by(questions, sample) %>%
dplyr::mutate(val = sum(val),
new_weight = val / sum(val)) %>%
dplyr::ungroup() %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = new_weight) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
View(variables_in_long_file)
survey_data %>% prop_grouped_survey_question(starts_with("importance_rights"))
library(tidyverse)
survey_data %>% prop_grouped_survey_question(starts_with("importance_rights"))
survey_data %>% prop_grouped_survey_question(starts_with("importance_rights"), partyid)
survey_data %>% prop_grouped_survey_question(questions = starts_with("importance_rights"), partyid)
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::group_by(questions, sample) %>%
dplyr::mutate(val = sum(val),
new_weight = val / sum(val)) %>%
dplyr::ungroup() %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = new_weight) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
survey_data %>% prop_grouped_survey_question(questions = starts_with("importance_rights"), partyid)
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
tidyr::drop_na(..., answer) %>%
dplyr::group_by(question, sample) %>%
dplyr::mutate(val = sum(val),
new_weight = val / sum(val)) %>%
dplyr::ungroup() %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = new_weight) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
survey_data %>% prop_grouped_survey_question(questions = starts_with("importance_rights"), partyid)
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
tidyr::drop_na(..., answer) %>%
dplyr::group_by(question, sample) %>%
dplyr::mutate(val = sum(answer),
new_weight = val / sum(val)) %>%
dplyr::ungroup() %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = new_weight) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
survey_data %>% prop_grouped_survey_question(questions = starts_with("importance_rights"), partyid)
prop_grouped_survey_question <- function(.data, questions, ...) {
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
tidyr::drop_na(..., answer) %>%
dplyr::group_by(question, sample) %>%
dplyr::mutate(val = sum(as.numeric(as.character(answer))),
new_weight = val / sum(val)) %>%
dplyr::ungroup() %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = new_weight) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
prop_grouped_survey_question <- function(.data, questions, ...) {
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
tidyr::drop_na(..., answer) %>%
dplyr::group_by(question, sample) %>%
dplyr::mutate(val = sum(as.numeric(as.character(answer))),
new_weight = val / sum(val)) %>%
dplyr::ungroup() %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = new_weight) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
survey_data %>% prop_grouped_survey_question(questions = starts_with("importance_rights"), partyid)
load("~/dropboxsydneyuni/ussc Au-Us/analysis/data/survey_long_data.rdata")
View(variables_in_long_file)
dplyr::select(party_id, starts_with("investments_owned"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(starts_with("investments_owned")), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(questions, sample) %>%
mutate(val = sum(val)) %>%
ungroup()
library(tidyverse)
df <- survey_data %>% dplyr::select(party_id, starts_with("investments_owned"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(starts_with("investments_owned")), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(questions, sample) %>%
mutate(val = sum(val)) %>%
ungroup()
df <- survey_data %>% dplyr::select(partyid, starts_with("investments_owned"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(starts_with("investments_owned")), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(questions, sample) %>%
mutate(val = sum(val)) %>%
ungroup()
df <- survey_data %>% dplyr::select(partyid, starts_with("investments_owned"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(questions, sample) %>%
mutate(val = sum(val)) %>%
ungroup()
df <- survey_data %>% dplyr::select(partyid, starts_with("investments_owned"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(question, sample) %>%
mutate(val = sum(answer)) %>%
ungroup()
df <- survey_data %>% dplyr::select(partyid, starts_with("investments_owned"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(question, sample) %>%
mutate(val = sum(as.numeric(as.character(answer)))) %>%
ungroup()
View(df)
df <- survey_data %>% dplyr::select(partyid, starts_with("investments_owned"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(question, sample) %>%
mutate(val = sum(as.numeric(answer))) %>%
ungroup()
df <- survey_data %>% dplyr::select(partyid, starts_with("increased_comm"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(question, sample) %>%
mutate(val = sum(as.numeric(answer))) %>%
ungroup()
View(df)
list(unique(df$val))
df <- survey_data %>% dplyr::select(partyid, starts_with("increased_comm"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(question, sample) %>%
mutate(val = sum(as.numeric(answer))) %>%
ungroup() %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = as.numeric(as.character(weight)))
df <- survey_data %>% dplyr::select(partyid, starts_with("increased_comm"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(question, sample) %>%
mutate(val = sum(as.numeric(answer))) %>%
ungroup() %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, starts_with("investments_owned"), description_au,
description_us,
answer, wt = as.numeric(as.character(weight)))
df <- survey_data %>% dplyr::select(partyid, starts_with("increased_comm"), weight, sample)  %>% tidyr::gather("question", "answer",
.dots =  -c(!!!(quos(starts_with("investments_owned"))), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
group_by(question, sample) %>%
mutate(val = sum(as.numeric(answer))) %>%
ungroup() %>%
tidyr::drop_na(partyid, answer) %>%
dplyr::count(sample, partyid, description_au,
description_us,
answer, wt = as.numeric(as.character(weight)))
devtools::build()
devtools::install_github('usstudiescentre/ussc', ref = "dev")
devtools::install_github('usstudiescentre/ussc',ref = 'dev')
devtools::install_github('usstudiescentre/ussc', ref = 'dev')
ussc::ussc_colours()
roxygen2::roxygenise
roxygen2::roxygenise()
setwd("..")
roxygen2::roxygenise()
install.packages('xml2')
roxygen2::roxygenise()
devtools::install_github('usstudiescentre/ussc')
devtools::install_github('usstudiescentre/ussc')
devtools::build()
devtools::build()
devtools::build()
devtools::roxygenise()
roxygen2::roxygenise()
install.packages('png')
roxygen2::roxygenise()
devtools::install_github('usstudiescentre/ussc')
ussc::ussc_pal
