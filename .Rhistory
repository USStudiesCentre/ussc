# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
View(speech_text)
speech_text <- folder_6   %>%
map(xml2::read_xml) %>%
map(~xml_find_all('//speech//talk.text')) %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
map(~mutate(speech_pos = row_number())) %>%
map(~unnest()) %>%
map(~spread(variable, -speech_pos)) %>%
map(~mutate(body = gsub("Honourable members:  ", "", body))) %>%
map(~mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))) %>%
map(~separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ")) %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
map(~mutate(pos = row_number())) %>%
bind_rows()
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ")
View(speech_text)
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
separate(body, c("time.stamp", "body"), sep = "\\):") %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
separate(body, c("time.stamp", "body"), sep = "\\):") %>%
separate(time.stamp, c("name", "time.stamp"), sep = "\\([0-9]") %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
xml <-  read_xml(here('data/6/2018-02-05.xml'))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
separate(body, c("time.stamp", "body"), sep = "\\):") %>%
separate(time.stamp, c("name", "time.stamp"), sep = "\\([0-9]") %>%
separate(name, c('name1', 'electorate1'), sep = "\\(") %>%
separate(electorate1, c('electorate1', 'role'), sep = "—") %>%
mutate(role = gsub("\\)", "", role)) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
separate(body, c("time.stamp", "body"), sep = "\\):") %>%
separate(time.stamp, c("name", "time.stamp"), sep = "\\([0-9]") %>%
separate(name, c('name1', 'electorate1'), sep = "\\(") %>%
separate(electorate1, c('electorate1', 'role'), sep = "—") %>%
mutate(role = gsub("\\)", "", role)) %>%
mutate(electorate1 = gsub("\\)", "", electorate1)) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
View(speech_talker)
xml <-  read_xml(here('data/6/2018-02-05.xml'))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
# separate(body, c("time.stamp", "body"), sep = "\\):") %>%
# separate(time.stamp, c("name", "time.stamp"), sep = "\\([0-9]") %>%
# separate(name, c('name1', 'electorate1'), sep = "\\(") %>%
# separate(electorate1, c('electorate1', 'role'), sep = "—") %>%
# mutate(role = gsub("\\)", "", role)) %>%
# mutate(electorate1 = gsub("\\)", "", electorate1)) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
View(speech_talker)
View(speech_talker)
library(here)
library(fs)
library(tidyverse)
library(furrr)
library(xml2)
# load list of files
data_new <- fs::dir_ls(here("data", "all_house"), glob = "*.xml")
# load additional file info from session info
session_info <- readRDS(here("data", "session_info.RData"))
# convert empty strings to NA
empty_as_na <- function(x){
if("factor" %in% class(x)) x <- as.character(x) ## since ifelse wont work with factors
ifelse(as.character(x)!="", x, NA)
}
xml <-  read_xml(here('data/6/2018-02-05.xml'))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
# separate(body, c("time.stamp", "body"), sep = "\\):") %>%
# separate(time.stamp, c("name", "time.stamp"), sep = "\\([0-9]") %>%
# separate(name, c('name1', 'electorate1'), sep = "\\(") %>%
# separate(electorate1, c('electorate1', 'role'), sep = "—") %>%
# mutate(role = gsub("\\)", "", role)) %>%
# mutate(electorate1 = gsub("\\)", "", electorate1)) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
View(speech_talker)
xml <-  read_xml(here('data/6/2018-02-28.xml'))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
# separate(body, c("time.stamp", "body"), sep = "\\):") %>%
# separate(time.stamp, c("name", "time.stamp"), sep = "\\([0-9]") %>%
# separate(name, c('name1', 'electorate1'), sep = "\\(") %>%
# separate(electorate1, c('electorate1', 'role'), sep = "—") %>%
# mutate(role = gsub("\\)", "", role)) %>%
# mutate(electorate1 = gsub("\\)", "", electorate1)) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)^(M(?:is)?s|(?:Mrs?))([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\.Dr([^:]*):  ") %>%
# separate_rows(body, sep = "\\?Dr([^:]*):  ") %>%
# separate_rows(body, sep = "(\\.|?|!)The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\?The DEPUTY SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The SPEAKER([^:]*):  ") %>%
# separate_rows(body, sep = "\\.The DEPUTY SPEAKER([^:]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
View(speech_talker)
head(speech_talker, 165)
head(speech_talker$body, 165)
head(speech_talker$body, 166)
head(speech_talker$body, 167)
library(here)
library(fs)
library(tidyverse)
library(furrr)
library(xml2)
# load list of files
data_new <- fs::dir_ls(here("data", "all_house"), glob = "*.xml")
# load additional file info from session info
session_info <- readRDS(here("data", "session_info.RData"))
# convert empty strings to NA
empty_as_na <- function(x){
if("factor" %in% class(x)) x <- as.character(x) ## since ifelse wont work with factors
ifelse(as.character(x)!="", x, NA)
}
xml <-  read_xml(here('data/6/2018-02-28.xml'))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
mutate(pos = row_number())
View(speech_text)
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
View(speech_talker)
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
# separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—]([^:]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—][Mr|Mrs|Sir|Dr]([A-Z :]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body)) %>%
separate_rows(body, sep = "[\\.|?|!|\\—][Mr|Mrs|Sir|Dr|The]([A-Z :]*):  ") %>%
mutate(pos = row_number())
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "pos"))
speech_text <- xml %>%
xml_find_all('//speech//talk.text') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))
speech_talker <- xml %>%
xml_find_all('//speech//talker') %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
mutate(speech_pos = row_number()) %>%
unnest() %>%
spread(variable, -speech_pos) %>%
full_join(speech_text, by = c("speech_pos" = "speech_pos"))
View(speech_talker)
folder_6 <- fs::dir_ls(here("data", "6"), glob = "*.xml")
folder_6 <- fs::dir_ls(here("data", "6"), glob = "*.xml")
speech_text <- folder_6 %>%
map(~xml_find_all('//speech//talk.text')) %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
map(~mutate(speech_pos = row_number())) %>%
map(~unnest()) %>%
map(~spread(variable, -speech_pos)) %>%
bind_rows() %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))
speech_text <- folder_6 %>%
map(xml_find_all('//speech//talk.text')) %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
map(~mutate(speech_pos = row_number())) %>%
map(~unnest()) %>%
map(~spread(variable, -speech_pos)) %>%
bind_rows() %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))
speech_text <- folder_6 %>%
map(xml2::read_xml) %>%
map(~xml_find_all('//speech//talk.text')) %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
map(~mutate(speech_pos = row_number())) %>%
map(~unnest()) %>%
map(~spread(variable, -speech_pos)) %>%
bind_rows() %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))
speech_text <- folder_6 %>%
map(xml2::read_xml, flatten = TRUE) %>%
map(~xml_find_all('//speech//talk.text')) %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
map(~mutate(speech_pos = row_number())) %>%
map(~unnest()) %>%
map(~spread(variable, -speech_pos)) %>%
bind_rows() %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))
speech_text <- folder_6 %>%
map(xml2::read_xml, flatten = TRUE) %>%
map(~xml_find_all(., '//speech//talk.text')) %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text)))) %>%
map(~mutate(speech_pos = row_number())) %>%
map(~unnest()) %>%
map(~spread(variable, -speech_pos)) %>%
bind_rows() %>%
mutate(body = gsub("Honourable members:  ", "", body)) %>%
mutate(body  = gsub("SPEAKER\\s*\\([^\\)]+\\)","SPEAKER", body))
speech_text <- folder_6 %>%
map(xml2::read_xml, flatten = TRUE) %>%
map(~xml_find_all(., '//speech//talk.text')) %>%
map_df(~data_frame(variable = list(map(xml_children(.x), xml_name)),
value = list(map(xml_children(.x), xml_text))))
View(speech_text)
head(speech_text)
View(speech_text)
setwd("~/Dropbox (Sydney Uni)/Rpackages/ussc/vignettes")
setwd("..")
pkgdown::clean_site()
pkgdown::build_site()
pkgdown::clean_site()
pkgdown::build_site()
