unite(subgroup, c(!!!(quos)), sep = "_") %>%
spread(subgroup, proportion)
}
d <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid)
View(d)
prop_survey_question <- function(.data, .questions) {
.data %>%
select(sample, .questions)  %>%
tidyr::gather("question", "answer", .dots =  -sample) %>%
left_join(variables_in_long_file %>% select(description_us, description_au value),
by = c("question" = "value")) %>%
count(sample, description_us, description_au, answer) %>%
group_by(sample, description_us, description_au) %>%
mutate(proportion = round(n/sum(n)*100, 0)) %>%
select(-n) %>%
ungroup() %>%
spread(sample, proportion)
}
prop_survey_question <- function(.data, .questions) {
.data %>%
select(sample, .questions)  %>%
tidyr::gather("question", "answer", .dots =  -sample) %>%
left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
count(sample, description_us, description_au, answer) %>%
group_by(sample, description_us, description_au) %>%
mutate(proportion = round(n/sum(n)*100, 0)) %>%
select(-n) %>%
ungroup() %>%
spread(sample, proportion)
}
View(variables_in_long_file)
d <- survey_data %>%
prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
select(sample, questions)  %>%
tidyr::gather("question", "answer", .dots =  -sample) %>%
left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
count(sample, description_us, description_au, answer) %>%
group_by(sample, description_us, description_au) %>%
mutate(proportion = round(n/sum(n)*100, 0)) %>%
select(-n) %>%
ungroup() %>%
spread(sample, proportion)
}
d <- survey_data %>%
prop_survey_question(questions = starts_with("importance_of"))
View(d)
d <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid) %>%
kable()
d <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid) %>%
knitr::kable()
d
d <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid, gender)
View(d)
survey_data %>%
prop_survey_question(questions = starts_with("importance_of"))
knitr::opts_chunk$set(
warning = FALSE,
message = FALSE,
comment = FALSE,
echo = FALSE
)
library(tidyverse)
library(ussc)
library(gt)
survey_data %>%  prop_grouped_survey_question(questions = starts_with("sexual_harrassment"), sample, partyid, gender)
f2 <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid) %>%
select(-description_au)
f2
f2 %>%
select(-description_us,
-`Australia_Other or none`) %>%
kable("html", booktabs = T, digits = 0) %>%
add_header_above(c(" " = 1,
"LNP" = 1,
"Greens" = 1,
"Labor" = 1,
"Dem." = 1,
"Ind." = 1,
"Rep." = 1)) %>%
add_header_above(c(" " = 1,
"Australia" = 3,
"United States" = 3), bold = T) %>%
group_rows(index = c("Men getting away with committing sexual harassment and assault" = 3,
"Women making false claims about sexual harassment or assault" = 3,
"Women not being believed about sexual harassment and assault" = 3))
knitr::opts_chunk$set(
warning = FALSE,
message = FALSE,
comment = FALSE,
echo = FALSE
)
library(tidyverse)
library(ussc)
library(knitr)
load(survey_long_data.rdata)
load("survey_long_data.rdata")
read_rds("survey_long_data.rdata")
load("survey_long_data.rdata")
load("survey_long_data.rds")
knitr::opts_chunk$set(
warning = FALSE,
message = FALSE,
comment = FALSE,
echo = FALSE
)
library(tidyverse)
library(ussc)
library(knitr)
load("survey_long_data.rds")
read_rds("survey_long_data.rds")
knitr::opts_chunk$set(echo = FALSE)
library(ussc)
library(tidyverse)
library(ggplot2)
library(kableExtra)
library(here)
load(here("analysis/data/survey_long_data.rdata"))
load("survey_long_data.rdata")
load("survey_long_data.rdata")
f1 <- survey_data %>%
prop_survey_question(questions = starts_with("importance_of")) %>%
select(-description_au) %>%
kable("html", booktabs = T, digits = 0)
devtools::build()
setwd("~/Dropbox (Sydney Uni)/Rpackages/ussc/vignettes")
setwd("~/Dropbox (Sydney Uni)/Rpackages/ussc")
devtools::build()
roxygen2::roxygenise()
devtools::install_github('usstudiescentre/ussc')
survey_data %>% ussc::prop_survey_question(starts_with("political_acumen"))
knitr::opts_chunk$set(
warning = FALSE,
message = FALSE,
comment = FALSE,
echo = FALSE
)
library(tidyverse)
library(ussc)
library(knitr)
library(kableExtra)
load("survey_long_data.rdata")
f1 <- survey_data %>%
prop_survey_question(questions = starts_with("importance_of")) %>%
select(-description_au) %>%
mutate(description = str_replace(description_us, "(insert country)n", "(insert country)")) %>%
select(-description_us) %>%
kable("html", booktabs = T, digits = 0)
f1
survey_data %>%
prop_survey_question(questions = starts_with("importance_of")) %>%
select(-description_au) %>%
mutate(description = str_replace(description_us, "(insert country)n", "(insert country)"),
description = str_replace(description_us, "(insert country)n", "(insert country)")) %>%
select(-description_us)
survey_data %>%
prop_survey_question(questions = starts_with("importance_of")) %>%
select(-description_au) %>%
mutate(description = str_replace_all(description_us, "(insert country)n", "(insert country)")) %>%
select(-description_us)
survey_data %>%
prop_survey_question(questions = starts_with("importance_of")) %>%
select(-description_au) %>%
mutate(description = str_replace_all(description_us, "(insert country)n", "(insert country)")) %>%
select(-description_us)
View(variables_in_long_file)
survey_data %>%
prop_survey_question(questions = starts_with("climate_change")) %>%
select(-description_au)
View(variables_in_long_file)
knitr::opts_chunk$set(
warning = FALSE,
message = FALSE,
comment = FALSE,
echo = TRUE
)
library(tidyverse)
library(ussc)
library(knitr)
library(kableExtra)
load("survey_long_data.rdata")
survey_data %>%
prop_survey_question(questions = starts_with("stance_on_tarrifs")) %>%
select(-description_au)
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}else(drop_NA = TRUE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
}
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}else(drop_NA = TRUE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
}
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}else(drop_NA = TRUE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
tidyr::drop_na(answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)}
}
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
} else(drop_NA = TRUE) {
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
tidyr::drop_na(answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)}
}
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
} else {
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
tidyr::drop_na(answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)}
}
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
} else {
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
tidyr::drop_na(answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
}
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
} else{
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
tidyr::drop_na(answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}}
prop_grouped_survey_question <- function(.data, questions, ..., drop_NA = TRUE) {
quos <- rlang::enquos(...)
if(drop_NA = FALSE){
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
} else{
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
tidyr::drop_na(answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(...) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos))) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(..., description_au, description_us, answer) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
devtools::install_github('usstudiescentre/ussc')
knitr::opts_chunk$set(
warning = FALSE,
message = FALSE,
comment = FALSE,
echo = TRUE
)
library(tidyverse)
library(ussc)
library(knitr)
library(kableExtra)
load("survey_long_data.rdata")
survey_data %>%
prop_survey_question(questions = starts_with("stance_on_tarrifs")) %>%
select(-description_au)
ussc::prop_grouped_survey_question
devtools::install_github('usstudiescentre/ussc')
devtools::install_github('usstudiescentre/ussc', force = TRUE)
ussc::prop_grouped_survey_question
roxygenise()
roxygen2::roxygenise()
devtools::install_github('usstudiescentre/ussc')
ussc::prop_grouped_survey_question
roxygen2::roxygenise()
pkgdown::clean_site()
pkgdown::build_site()
