.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
mutate(answer = fct_reorder(answer)) %>%
# mutate(answer = case_when(
#   # grepl(question,
#   #       "agree|politicians_trustworthy|political_acumen") ~ factor(answer,
#   #                                                          levels = c(
#   #                                                            "Strongly agree",
#   #                                                            "Agree",
#   #                                                            "Neither agree nor disagree",
#   #                                                            "Disagree",
#   #                                                            "Strongly disagree"
#   #                                                          )
#   #               ),
#   # starts_with(question,
#   #       'econ_investment') ~ factor(answer, levels = c(
#   #         "Much more economic investment",
#   #         "A little more economic investment",
#   #         "About the same amount of economic investment as now",
#   #         "A little less economic investment",
#   #         "Much less economic investment"
#   #       )
#   #       ),
#   str_detect(question,
#         'political_systems') ~ factor(answer, levels = c(
#           "Very good",
#           "Fairly good",
#           "Fairly bad",
#           "Very bad"
#         )
#         ),
#   str_detect(question,
#         'investments_owned') ~ factor(answer, levels = c(
#           "Yes",
#           "No",
#           "Refuse to say, or unsure"
#         )
#         ),
#   str_detect(question,
#         'favourability') ~ factor(answer, levels = c(
#           "Very favourable",
#           "Somewhat favourable",
#           "Somewhat unfavourable",
#           "Very unfavourable"
#         )
#         ),
#   # starts_with(question,
#   #       'importance_of_truly_being') ~ factor(answer, levels = c(
#   #         "Very important",
#   #         "Fairly important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'importance_rights') ~ factor(answer, levels = c(
#   #         "Extremely important",
#   #         "Very important",
#   #         "Moderately important",
#   #         "Slightly important",
#   #         "Not at all important"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'econ_mobility') ~ factor(answer, levels = c(
#   #         "Essential",
#   #         "Very important",
#   #         "Somewhat important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'fossil_fuels') ~ factor(answer, levels = c(
#   #         "Strongly support",
#   #         "Support",
#   #         "Neither support nor oppose",
#   #         "Oppose",
#   #         "Strongly oppose",
#   #         "Don't know"
#   #       )
#   #       ),
#   TRUE ~ .$answer
#   )) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender, levels = c("Yes", "No", "Refuse to say, or unsure"))
prop_grouped_survey_question <- function(.data, questions, ..., levels) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
mutate(answer = fct_reorder(answer, levels)) %>%
# mutate(answer = case_when(
#   # grepl(question,
#   #       "agree|politicians_trustworthy|political_acumen") ~ factor(answer,
#   #                                                          levels = c(
#   #                                                            "Strongly agree",
#   #                                                            "Agree",
#   #                                                            "Neither agree nor disagree",
#   #                                                            "Disagree",
#   #                                                            "Strongly disagree"
#   #                                                          )
#   #               ),
#   # starts_with(question,
#   #       'econ_investment') ~ factor(answer, levels = c(
#   #         "Much more economic investment",
#   #         "A little more economic investment",
#   #         "About the same amount of economic investment as now",
#   #         "A little less economic investment",
#   #         "Much less economic investment"
#   #       )
#   #       ),
#   str_detect(question,
#         'political_systems') ~ factor(answer, levels = c(
#           "Very good",
#           "Fairly good",
#           "Fairly bad",
#           "Very bad"
#         )
#         ),
#   str_detect(question,
#         'investments_owned') ~ factor(answer, levels = c(
#           "Yes",
#           "No",
#           "Refuse to say, or unsure"
#         )
#         ),
#   str_detect(question,
#         'favourability') ~ factor(answer, levels = c(
#           "Very favourable",
#           "Somewhat favourable",
#           "Somewhat unfavourable",
#           "Very unfavourable"
#         )
#         ),
#   # starts_with(question,
#   #       'importance_of_truly_being') ~ factor(answer, levels = c(
#   #         "Very important",
#   #         "Fairly important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'importance_rights') ~ factor(answer, levels = c(
#   #         "Extremely important",
#   #         "Very important",
#   #         "Moderately important",
#   #         "Slightly important",
#   #         "Not at all important"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'econ_mobility') ~ factor(answer, levels = c(
#   #         "Essential",
#   #         "Very important",
#   #         "Somewhat important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'fossil_fuels') ~ factor(answer, levels = c(
#   #         "Strongly support",
#   #         "Support",
#   #         "Neither support nor oppose",
#   #         "Oppose",
#   #         "Strongly oppose",
#   #         "Don't know"
#   #       )
#   #       ),
#   TRUE ~ .$answer
#   )) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender, levels = c("Yes", "No", "Refuse to say, or unsure"))
prop_grouped_survey_question <- function(.data, questions, ..., levels) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
mutate(answer = fct_reorder(answer, !!!levels)) %>%
# mutate(answer = case_when(
#   # grepl(question,
#   #       "agree|politicians_trustworthy|political_acumen") ~ factor(answer,
#   #                                                          levels = c(
#   #                                                            "Strongly agree",
#   #                                                            "Agree",
#   #                                                            "Neither agree nor disagree",
#   #                                                            "Disagree",
#   #                                                            "Strongly disagree"
#   #                                                          )
#   #               ),
#   # starts_with(question,
#   #       'econ_investment') ~ factor(answer, levels = c(
#   #         "Much more economic investment",
#   #         "A little more economic investment",
#   #         "About the same amount of economic investment as now",
#   #         "A little less economic investment",
#   #         "Much less economic investment"
#   #       )
#   #       ),
#   str_detect(question,
#         'political_systems') ~ factor(answer, levels = c(
#           "Very good",
#           "Fairly good",
#           "Fairly bad",
#           "Very bad"
#         )
#         ),
#   str_detect(question,
#         'investments_owned') ~ factor(answer, levels = c(
#           "Yes",
#           "No",
#           "Refuse to say, or unsure"
#         )
#         ),
#   str_detect(question,
#         'favourability') ~ factor(answer, levels = c(
#           "Very favourable",
#           "Somewhat favourable",
#           "Somewhat unfavourable",
#           "Very unfavourable"
#         )
#         ),
#   # starts_with(question,
#   #       'importance_of_truly_being') ~ factor(answer, levels = c(
#   #         "Very important",
#   #         "Fairly important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'importance_rights') ~ factor(answer, levels = c(
#   #         "Extremely important",
#   #         "Very important",
#   #         "Moderately important",
#   #         "Slightly important",
#   #         "Not at all important"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'econ_mobility') ~ factor(answer, levels = c(
#   #         "Essential",
#   #         "Very important",
#   #         "Somewhat important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'fossil_fuels') ~ factor(answer, levels = c(
#   #         "Strongly support",
#   #         "Support",
#   #         "Neither support nor oppose",
#   #         "Oppose",
#   #         "Strongly oppose",
#   #         "Don't know"
#   #       )
#   #       ),
#   TRUE ~ .$answer
#   )) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender, levels = c("Yes", "No", "Refuse to say, or unsure"))
prop_grouped_survey_question <- function(.data, questions, ..., levels) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
mutate(answer = fct_reorder(answer, !!!enquos(levels))) %>%
# mutate(answer = case_when(
#   # grepl(question,
#   #       "agree|politicians_trustworthy|political_acumen") ~ factor(answer,
#   #                                                          levels = c(
#   #                                                            "Strongly agree",
#   #                                                            "Agree",
#   #                                                            "Neither agree nor disagree",
#   #                                                            "Disagree",
#   #                                                            "Strongly disagree"
#   #                                                          )
#   #               ),
#   # starts_with(question,
#   #       'econ_investment') ~ factor(answer, levels = c(
#   #         "Much more economic investment",
#   #         "A little more economic investment",
#   #         "About the same amount of economic investment as now",
#   #         "A little less economic investment",
#   #         "Much less economic investment"
#   #       )
#   #       ),
#   str_detect(question,
#         'political_systems') ~ factor(answer, levels = c(
#           "Very good",
#           "Fairly good",
#           "Fairly bad",
#           "Very bad"
#         )
#         ),
#   str_detect(question,
#         'investments_owned') ~ factor(answer, levels = c(
#           "Yes",
#           "No",
#           "Refuse to say, or unsure"
#         )
#         ),
#   str_detect(question,
#         'favourability') ~ factor(answer, levels = c(
#           "Very favourable",
#           "Somewhat favourable",
#           "Somewhat unfavourable",
#           "Very unfavourable"
#         )
#         ),
#   # starts_with(question,
#   #       'importance_of_truly_being') ~ factor(answer, levels = c(
#   #         "Very important",
#   #         "Fairly important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'importance_rights') ~ factor(answer, levels = c(
#   #         "Extremely important",
#   #         "Very important",
#   #         "Moderately important",
#   #         "Slightly important",
#   #         "Not at all important"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'econ_mobility') ~ factor(answer, levels = c(
#   #         "Essential",
#   #         "Very important",
#   #         "Somewhat important",
#   #         "Not very important",
#   #         "Not important at all"
#   #       )
#   #       ),
#   # starts_with(question,
#   #       'fossil_fuels') ~ factor(answer, levels = c(
#   #         "Strongly support",
#   #         "Support",
#   #         "Neither support nor oppose",
#   #         "Oppose",
#   #         "Strongly oppose",
#   #         "Don't know"
#   #       )
#   #       ),
#   TRUE ~ .$answer
#   )) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender, levels = c("Yes", "No", "Refuse to say, or unsure"))
levels(df$answer)
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer",
.dots =  -c(!!!(quos), weight, sample),
na.rm = TRUE) %>%
dplyr::left_join(variables_in_long_file %>%
select(description_us, description_au, value),
by = c("question" = "value")) %>%
mutate(answer = factor(answer)) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au,
description_us,
answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>% mutate(answer = fct_recode(answer, c("Yes", "No", "Refuse to say, or unsure")))
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>% mutate(answer = fct_relevel(answer, levels = c("Yes", "No", "Refuse to say, or unsure"))))
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>% mutate(answer = fct_relevel(answer, levels = c("Yes", "No", "Refuse to say, or unsure")))
df
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>% mutate(answer = fct_relevel(answer,  c("Yes", "No", "Refuse to say, or unsure")))
View(df)
df$answer
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>% mutate(answer = fct_relevel(answer,  c("Yes", "No", "Refuse to say, or unsure"))) %>% group_by(description_au, answer) %>% arrange()
View(df)
View(survey_data)
View(df)
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>% mutate(answer = fct_relevel(answer,  c("Yes", "No", "Refuse to say, or unsure"))) %>% arrange(description_au, answer)
View(df)
relevel_survey_answer <- function(.data, levels) {
.data %>%
dplyr::mutate(answer = fct_relevel(answer, levels)) %>%
dplyr::arange(description_us, answer)
}
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>%
relevel_survey_answer(levels = c("Yes", "No", "Refuse to say, or unsure"))
relevel_survey_answer <- function(.data, levels) {
.data %>%
dplyr::mutate(answer = fct_relevel(answer, levels)) %>%
dplyr::arrange(description_us, answer)
}
df <- survey_data %>% prop_grouped_survey_question(starts_with("investments_owned"), gender) %>%
relevel_survey_answer(levels = c("Yes", "No", "Refuse to say, or unsure"))
View(df)
df <- survey_data %>% prop_grouped_survey_question(starts_with("importance_of"), gender) %>%
relevel_survey_answer(levels = c("Yes", "No", "Refuse to say, or unsure"))
df <- survey_data %>% prop_grouped_survey_question(starts_with("importance_of"), gender)
View(df)
df <- survey_data %>% prop_grouped_survey_question(starts_with("importance_of"), gender) %>%
relevel_survey_answer(levels = c("Very important", "Not very important","Fairly important", "Not important at all"))
View(df)
df <- survey_data %>% prop_grouped_survey_question(starts_with("importance_of"), gender) %>%
relevel_survey_answer(levels = c("Very important", "Fairly important","Not very important", "Not important at all"))
View(df)
setwd("..")
devtools::document()
devtools::install_github('usstudiescentre/ussc')
pkgdown::clean_site()
pkgdown::build_site()
pkgdown::clean_site()
pkgdown::build_site()
pkgdown::build_site()
knitr::opts_chunk$set(
warning = FALSE,
message = FALSE,
comment = FALSE,
echo = FALSE
)
library(tidyverse)
library(ussc)
library(gt)
library(fiftystater)
data("fifty_states") # this line is optional due to lazy data loading
crimes <- data.frame(state = tolower(rownames(USArrests)), USArrests)
# map_id creates the aesthetic mapping to the state name column in your data
ggplot(crimes, aes(map_id = state)) +
geom_map(aes(fill = Assault), map = fifty_states, colour = "white") +
expand_limits(x = fifty_states$long, y = fifty_states$lat) +
coord_map() +
scale_fill_gradient(low="#56B1F7", high="#132B43") +
scale_x_continuous(breaks = NULL) +
scale_y_continuous(breaks = NULL) +
annotate("text", x = -88, y = 50, label = "Borders should (usually) be thin light lines", color = "purple") +
labs(x = "", y = "") +
theme(legend.position = "bottom",
panel.background = element_blank())
ussc_colours()
