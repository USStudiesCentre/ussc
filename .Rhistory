library(ussc)
library(DT)
url <- 'http://cawp.rutgers.edu/2018-election-night-tally'
webpage <- read_html(url)
winner_tables <- webpage %>%
html_nodes("table") %>%
html_table(fill = TRUE)
glimpse(winner_tables[[1]])
glimpse(winner_tables[[2]])
glimpse(winner_tables[[3]])
senate_winner <- winner_tables[[1]] %>%
select(c(4)) %>%
slice(2) %>%
separate(X4, into = c("Democrat","Republican"), sep = 'D,') %>%
mutate(Republican = gsub("R", "", Republican)) %>%
mutate(Democrat = gsub("D", "", Democrat)) %>%
gather(party, women) %>%
mutate(year = 2018,
office = "Senate",
women = as.numeric(as.character(women)))
house_winner <- winner_tables[[2]] %>%
select(c(4)) %>%
slice(2) %>%
separate(X4, into = c("Democrat","Republican"), sep = 'D,') %>%
mutate(Republican = gsub("R", "", Republican)) %>%
mutate(Democrat = gsub("D", "", Democrat)) %>%
gather(party, women) %>%
mutate(year = 2018,
office = "House",
women = as.numeric(as.character(women)))
gov_winner <- winner_tables[[3]] %>%
select(c(4)) %>%
slice(2) %>%
separate(X4, into = c("Democrat","Republican"), sep = 'D,') %>%
mutate(Republican = gsub("R", "", Republican)) %>%
mutate(Democrat = gsub("D", "", Democrat)) %>%
gather(party, women) %>%
mutate(year = 2018,
office = "Governor",
women = as.numeric(as.character(women)))
ggplot(house_winner) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none') +
labs(x = "Party",
y = "Number of women winning seats in office",
title = "Women in the 2018 midterms: House of Representatives")
#ggsave(last_plot(), file = "../graphs/house_barchart_women.png")
ggplot(senate_winner) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none') +
labs(x = "Party",
y = "Number of women winning seats in office",
title = "Women in the 2018 midterms: Senate")
#ggsave(last_plot(), file = paste0("../graphs/senate_barchart_women.png"))
ggplot(gov_winner) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none') +
labs(x = "Party",
y = "Number of women winning seats in office",
title = "Women in the 2018 midterms: Governor")
#ggsave(last_plot(), file = "../graphs/governor_barchart_women.png")
combine_data <- bind_rows(gov_winner, house_winner, senate_winner)
ggplot(combine_data) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none',
axis.title.y = element_text(angle = 0)) +
labs(x = "Party",
y = "# of\nwomen\nwinning\nseats",
title = "Women in the 2018 midterms") +
facet_grid(~office)
ggsave(last_plot(), file = "../graphs/barchart_women.png")
library(tidyverse)
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv")
View(al)
al_split <- split(al, al$AL.Governor)
View(al_split)
View(al_split)
al_split[["AL House 03"]]
al_split <- split(al, al$AL.Governor == "More Details")
View(al_split)
View(al_split)
al_split[[1]]
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
mutate(y = length(seq(AL.governor,  by = 'More Details')) - 1)
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
mutate(y = length(seq(AL.governor,  by = 'More Details')) - 1)
View(al)
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
mutate(y = length(seq(`AL.governor`,  by = 'More Details')) - 1)
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
mutate(y = length(seq(AL.Governor,  by = 'More Details')) - 1)
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
mutate(y = length(seq(AL.Governor,AL.Governor  by = 'More Details')) - 1)
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
mutate(y = length(seq(AL.Governor,AL.Governor,  by = 'More Details')) - 1)
mutate(y = cumsum(AL.Governor)
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
al <- read.csv("~/dropboxsydneyuni/midterms_ussc/election/data/states/alabama.csv") %>%
mutate(y = cumsum(AL.Governor))
sum(al$y[cumsum(al$AL.Governor == "More Details") == 0])
sum(al$y[cumsum(al$AL.Governor == "More Details") == 1])
subset(al,  AL.Governor == "More Details")
md <- subset(al,  AL.Governor == "More Details")
View(md)
row_number(md)
al_split <- split(al, subset(al,  AL.Governor == "More Details"))
View(al_split)
View(al_split)
al_split <- split(al, cumsum(1:nrow(al) %in% md))
View(al_split)
View(al_split)
View(al_split)
nrow(md)
al_split <- split(al, cumsum(1:nrow(al) %in% md))
View(al_split)
md <- subset(al,  AL.Governor == "More Details")
View(md)
md <- subset(al,  AL.Governor == "More Details") %>%
add_rownames(df, "row_n")
md <- subset(al,  AL.Governor == "More Details") %>%
add_rownames(., "row_n")
md <- subset(al,  AL.Governor == "More Details") %>%
rownames_to_column(., "row_n")
md <- subset(al,  AL.Governor == "More Details") %>%
rownames_to_column(., "row_n") %>%
select(1)
split(al,  cumsum(1:nrow(al) %in% md))
dat <- split(al,  cumsum(1:nrow(al) %in% md))
View(dat)
as.list(md)
as.list.data.frame(md)
dat <- split(al,  cumsum(1:nrow(al) %in% md$row_n))
View(dat)
View(dat)
View(dat)
library(here)
knitr::opts_chunk$set(echo = FALSE)
library(rvest)
library(tidyverse)
library(janitor)
library(filesstrings)
library(zoo)
library(ggpubr)
library(ussc)
library(DT)
url <- 'http://cawp.rutgers.edu/2018-election-night-tally'
webpage <- read_html(url)
winner_tables <- webpage %>%
html_nodes("table") %>%
html_table(fill = TRUE)
glimpse(winner_tables[[1]])
glimpse(winner_tables[[2]])
glimpse(winner_tables[[3]])
senate_winner <- winner_tables[[1]] %>%
select(c(4)) %>%
slice(2) %>%
separate(X4, into = c("Democrat","Republican"), sep = 'D,') %>%
mutate(Republican = gsub("R", "", Republican)) %>%
mutate(Democrat = gsub("D", "", Democrat)) %>%
gather(party, women) %>%
mutate(year = 2018,
office = "Senate",
women = as.numeric(as.character(women)))
house_winner <- winner_tables[[2]] %>%
select(c(4)) %>%
slice(2) %>%
separate(X4, into = c("Democrat","Republican"), sep = 'D,') %>%
mutate(Republican = gsub("R", "", Republican)) %>%
mutate(Democrat = gsub("D", "", Democrat)) %>%
gather(party, women) %>%
mutate(year = 2018,
office = "House",
women = as.numeric(as.character(women)))
gov_winner <- winner_tables[[3]] %>%
select(c(4)) %>%
slice(2) %>%
separate(X4, into = c("Democrat","Republican"), sep = 'D,') %>%
mutate(Republican = gsub("R", "", Republican)) %>%
mutate(Democrat = gsub("D", "", Democrat)) %>%
gather(party, women) %>%
mutate(year = 2018,
office = "Governor",
women = as.numeric(as.character(women)))
ggplot(house_winner) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none') +
labs(x = "Party",
y = "Number of women winning seats in office",
title = "Women in the 2018 midterms: House of Representatives")
#ggsave(last_plot(), file = "../graphs/house_barchart_women.png")
ggplot(senate_winner) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none') +
labs(x = "Party",
y = "Number of women winning seats in office",
title = "Women in the 2018 midterms: Senate")
#ggsave(last_plot(), file = paste0("../graphs/senate_barchart_women.png"))
ggplot(gov_winner) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none') +
labs(x = "Party",
y = "Number of women winning seats in office",
title = "Women in the 2018 midterms: Governor")
#ggsave(last_plot(), file = "../graphs/governor_barchart_women.png")
combine_data <- bind_rows(gov_winner, house_winner, senate_winner)
ggplot(combine_data) +
geom_bar(aes(party, women, fill = party), stat = 'identity') +
theme_ussc() +
scale_fill_ussc("light") +
theme(legend.position = 'none',
axis.title.y = element_text(angle = 0)) +
labs(x = "Party",
y = "# of\nwomen\nwinning\nseats",
title = "Women in the 2018 midterms") +
facet_grid(~office)
ggsave(last_plot(), file = "../graphs/barchart_women.png")
View(dat)
dat[["0"]]
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
# load list of MPs
load(here("data/list_of_mps.RData"))
head(parliamentarians)
#1901 to 1980
load(here("data/transcripts_1901-1980.RData"))
head(speeches_1901_1980)
# subset parliamentarians
parliamentarians_1901_1980 <- parliamentarians %>%
filter(parliament_no %in% c(1:32)) %>%
mutate(member = sub("\\s+\\S+(?=\\s)", '', member, perl=TRUE))
speeches_1901_1980 <- speeches_1901_1980 %>%
mutate(full_name = sub("\\s+\\S+(?=\\s)", '', full_name, perl=TRUE),
full_name = str_trim(full_name, "both")) %>%
full_join(parliamentarians_1901_1980, by = c("full_name" = "member",
"parliament_no" = "parliament_no")) %>%
select(-party.x, -electorate.x) %>%
rename(electorate = electorate.y,
party = party.y) %>%
distinct()
saveRDS(parliamentarians_1901_1980, file = here("data/transcripts_1901_1980.RData"))
#1981 to 1997
load(here("data/transcripts_1981-1997.RData"))
head(speeches_1981_1997)
list(unique(speeches_1981_1997$parliament_no))
# replace 1 with 38
speeches_1981_1997 <- speeches_1981_1997 %>%
mutate(parliament_no = replace(parliament_no, parliament_no==1, 38)) %>%
mutate(name = gsub("Mr|Mrs|Dr|Sir", "", name),
name = stringr::str_trim(name, "both"))
parliamentarians_1981_1997 <- parliamentarians %>%
filter(parliament_no %in% c(32,33,34,35,36,37,38)) %>%
mutate(member = stringr::str_trim(member, "both"))
speeches_1981_1997 <- speeches_1981_1997 %>%
full_join(parliamentarians_1981_1997, by = c("name" = "surname",
"parliament_no" = "parliament_no")) %>%
full_join(parliamentarians_1981_1997, by = c("name" = "member",
"parliament_no" = "parliament_no")) %>%
mutate(first_name = coalesce(first_name.x, first_name.y),
party = coalesce(party.x, party.y),
electorate = coalesce(electorate.y, electorate.y),
state = coalesce(state.x, state.y),
term = coalesce(term.x, term.y),
name = coalesce(member, name)) %>%
select(-ends_with(".x"),
-ends_with(".y")) %>%
rename(full_name = name) %>%
separate(full_name, c("first", "surname"), remove = FALSE) %>%
select(-member, -first_name) %>%
rename(first_name = first) %>%
mutate(first_name = replace(first_name, first_name == "Speaker", NA),
surname = replace(surname, surname == "Clerk", NA),
first_name = replace(first_name, first_name == "Clerk", NA)) %>%
distinct()
saveRDS(speeches_1981_1997, file = here("data/transcripts_1981_1997.RData"))
# 1998 to 1999
load(here("data/transcripts_1998_1999.RData"))
transcripts_1998_1999 <- speeches_99_1
head(transcripts_1998_1999)
parliamentarians_1998_1999 <- parliamentarians %>%
filter(parliament_no %in% c(38, 39))
transcripts_1998_1999 <- transcripts_1998_1999 %>%
mutate(full_name = str_trim(full_name, "both"),
full_name = str_to_title(full_name)) %>%
full_join(parliamentarians_1998_1999, by = c("full_name" = "member",
"parliament_no" = "parliament_no")) %>%
full_join(parliamentarians_1998_1999, by = c("full_name" = "surname",
"parliament_no" = "parliament_no")) %>%
mutate( member_ = coalesce(member, full_name),
#   party = coalesce(party.x, party.y),
electorate = coalesce(electorate.x, electorate.y),
first_name = coalesce(first_name.x, first_name.y),
state = coalesce(state.x, state.y),
term = coalesce(term.x, term.y)) %>%
rename("file_" = "file.x") %>%
select(-ends_with(".x"),
-ends_with(".y")) %>%
left_join(parliamentarians_1998_1999, by = c("member_" = "member")) %>%
select(-ends_with(".x"),
-member_,
-member) %>%
rename(
"first_name" = "first_name.y",
"surname" = "surname.y",
"party" = "party.y",
"electorate" = "electorate.y",
"state" = "state.y",
"term" = "term.y",
"parliament_no" = "parliament_no.y") %>%
mutate(role = NA) %>% distinct()
saveRDS(transcripts_1998_1999, file = here("data", "transcripts_1998_1999.RData"))
# 2000 to 2010
load("/Users/zoemeers/Dropbox (Sydney Uni)/working_papers/JointLiuMansillo/data/transcripts_2000_2010.RData")
head(speeches_2000_2010)
#list(unique(speeches_2000_2010$parliament_no))
parliamentarians_2000_2010 <- parliamentarians %>%
filter(parliament_no %in% c(39:43)) %>%
mutate(surname = str_trim(surname, "both"))
speeches_2000_2010 <- speeches_2000_2010 %>%
select(-file.y) %>%
mutate(full_name = str_trim(full_name, "both"),
full_name = gsub("\\(Deputy Speaker\\)\\ ", "", full_name),
full_name = gsub("^O'keefe", "Neil O'keefe", full_name),
full_name = gsub("Chris Pyne", "Christopher Pyne", full_name)) %>%
rename("file" = "file.x") %>%
full_join(parliamentarians_2000_2010,
by = c("full_name" = "member",
"parliament_no" = "parliament_no")) %>%
select(-party.x, -electorate.x) %>%
rename("party" = "party.y",
"electorate" = "electorate.y") %>%
mutate(role = NA) %>%
distinct()
saveRDS(speeches_2000_2010, file = here("data", "transcripts_2000_2010.RData"))
# 2010 to 2012
load("/Users/zoemeers/Dropbox (Sydney Uni)/working_papers/JointLiuMansillo/data/transcripts_2010_2012.RData")
head(transcripts_2010_2012)
parliamentarians_2010_2010 <- parliamentarians %>%
filter(parliament_no %in% c(42:43)) %>%
mutate(surname = str_trim(surname, "both")) %>%
mutate(member = str_trim(member, "both")) %>%
distinct()
transcripts_2010_2012 <- transcripts_2010_2012 %>%
separate(name, c("surname", "first_name"), sep = ", ") %>%
mutate(first_name = str_to_title(first_name),
first_name = gsub(" \\(The Deputy Speaker\\)", "", first_name)) %>%
mutate(full_name = paste(first_name, surname),
full_name = str_to_title(full_name),
surname = str_to_title(surname),
full_name = str_trim(full_name, "both"),
first_name = str_trim(first_name, "both"),
surname = str_trim(surname, "both"),
electorate = str_trim(electorate, "both"),
full_name = gsub("Dr", "", full_name),
full_name =  gsub("Gregory Hunt", "Greg Hunt", full_name),
full_name =   gsub("Chris Pyne", "Christopher Pyne", full_name),
full_name =   gsub("Anthony Smith", "Tony Smith", full_name),
full_name =   gsub("Brendan  O'connor", "Brendan O'connor",full_name) )%>%
full_join(parliamentarians_2010_2010, by = c("full_name" = "member",
"parliament_no" = "parliament_no")) %>%
mutate_all(funs(empty_as_na)) %>%
distinct() %>%
select(-ends_with(".x")) %>%
rename("first_name" = "first_name.y",
"surname" = "surname.y",
"electorate" = "electorate.y")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
# convert empty strings to NA
empty_as_na <- function(x){
if("factor" %in% class(x)) x <- as.character(x) ## since ifelse wont work with factors
ifelse(as.character(x)!="", x, NA)
}
# load list of MPs
load(here("data/list_of_mps.RData"))
head(parliamentarians)
#1901 to 1980
load(here("data/transcripts_1901-1980.RData"))
head(speeches_1901_1980)
# subset parliamentarians
parliamentarians_1901_1980 <- parliamentarians %>%
filter(parliament_no %in% c(1:32)) %>%
mutate(member = sub("\\s+\\S+(?=\\s)", '', member, perl=TRUE))
speeches_1901_1980 <- speeches_1901_1980 %>%
mutate(full_name = sub("\\s+\\S+(?=\\s)", '', full_name, perl=TRUE),
full_name = str_trim(full_name, "both")) %>%
full_join(parliamentarians_1901_1980, by = c("full_name" = "member",
"parliament_no" = "parliament_no")) %>%
select(-party.x, -electorate.x) %>%
rename(electorate = electorate.y,
party = party.y) %>%
distinct()
saveRDS(parliamentarians_1901_1980, file = here("data/transcripts_1901_1980.RData"))
#1981 to 1997
load(here("data/transcripts_1981-1997.RData"))
head(speeches_1981_1997)
list(unique(speeches_1981_1997$parliament_no))
# replace 1 with 38
speeches_1981_1997 <- speeches_1981_1997 %>%
mutate(parliament_no = replace(parliament_no, parliament_no==1, 38)) %>%
mutate(name = gsub("Mr|Mrs|Dr|Sir", "", name),
name = stringr::str_trim(name, "both"))
parliamentarians_1981_1997 <- parliamentarians %>%
filter(parliament_no %in% c(32,33,34,35,36,37,38)) %>%
mutate(member = stringr::str_trim(member, "both"))
speeches_1981_1997 <- speeches_1981_1997 %>%
full_join(parliamentarians_1981_1997, by = c("name" = "surname",
"parliament_no" = "parliament_no")) %>%
full_join(parliamentarians_1981_1997, by = c("name" = "member",
"parliament_no" = "parliament_no")) %>%
mutate(first_name = coalesce(first_name.x, first_name.y),
party = coalesce(party.x, party.y),
electorate = coalesce(electorate.y, electorate.y),
state = coalesce(state.x, state.y),
term = coalesce(term.x, term.y),
name = coalesce(member, name)) %>%
select(-ends_with(".x"),
-ends_with(".y")) %>%
rename(full_name = name) %>%
separate(full_name, c("first", "surname"), remove = FALSE) %>%
select(-member, -first_name) %>%
rename(first_name = first) %>%
mutate(first_name = replace(first_name, first_name == "Speaker", NA),
surname = replace(surname, surname == "Clerk", NA),
first_name = replace(first_name, first_name == "Clerk", NA)) %>%
distinct()
saveRDS(speeches_1981_1997, file = here("data/transcripts_1981_1997.RData"))
# 1998 to 1999
load(here("data/transcripts_1998_1999.RData"))
# 1998 to 1999
read_rds(here("data/transcripts_1998_1999.RData"))
# 1998 to 1999
transcripts_1998_1999 <- read_rds(here("data/transcripts_1998_1999.RData"))
head(transcripts_1998_1999)
parliamentarians_1998_1999 <- parliamentarians %>%
filter(parliament_no %in% c(38, 39))
transcripts_1998_1999 <- transcripts_1998_1999 %>%
mutate(full_name = str_trim(full_name, "both"),
full_name = str_to_title(full_name)) %>%
full_join(parliamentarians_1998_1999, by = c("full_name" = "member",
"parliament_no" = "parliament_no")) %>%
full_join(parliamentarians_1998_1999, by = c("full_name" = "surname",
"parliament_no" = "parliament_no")) %>%
mutate( member_ = coalesce(member, full_name),
#   party = coalesce(party.x, party.y),
electorate = coalesce(electorate.x, electorate.y),
first_name = coalesce(first_name.x, first_name.y),
state = coalesce(state.x, state.y),
term = coalesce(term.x, term.y)) %>%
rename("file_" = "file.x") %>%
select(-ends_with(".x"),
-ends_with(".y")) %>%
left_join(parliamentarians_1998_1999, by = c("member_" = "member")) %>%
select(-ends_with(".x"),
-member_,
-member) %>%
rename(
"first_name" = "first_name.y",
"surname" = "surname.y",
"party" = "party.y",
"electorate" = "electorate.y",
"state" = "state.y",
"term" = "term.y",
"parliament_no" = "parliament_no.y") %>%
mutate(role = NA) %>% distinct()
saveRDS(transcripts_1998_1999, file = here("data", "transcripts_1998_1999.RData"))
saveRDS(speeches_2000_2010, file = here("data", "transcripts_2000_2010.RData"))
transcripts_2010_2012 <- transcripts_2010_2012 %>%
separate(name, c("surname", "first_name"), sep = ", ") %>%
mutate(first_name = str_to_title(first_name),
first_name = gsub(" \\(The Deputy Speaker\\)", "", first_name)) %>%
mutate(full_name = paste(first_name, surname),
full_name = str_to_title(full_name),
surname = str_to_title(surname),
full_name = str_trim(full_name, "both"),
first_name = str_trim(first_name, "both"),
surname = str_trim(surname, "both"),
electorate = str_trim(electorate, "both"),
full_name = gsub("Dr", "", full_name),
full_name =  gsub("Gregory Hunt", "Greg Hunt", full_name),
full_name =   gsub("Chris Pyne", "Christopher Pyne", full_name),
full_name =   gsub("Anthony Smith", "Tony Smith", full_name),
full_name =   gsub("Brendan  O'connor", "Brendan O'connor",full_name) )%>%
full_join(parliamentarians_2010_2010, by = c("full_name" = "member",
"parliament_no" = "parliament_no")) %>%
mutate_all(funs(empty_as_na)) %>%
distinct() %>%
select(-ends_with(".x")) %>%
rename("first_name" = "first_name.y",
"surname" = "surname.y",
"electorate" = "electorate.y")
saveRDS(transcripts_2010_2012, file = here("data", "transcripts_2010_2012.RData"))
# load additional file info from session info
session_info <- readRDS(here("data", "session_info.RData"))
library(here)
library(here)
setwd("~/dropboxsydneyuni/rpackages/ussc")
