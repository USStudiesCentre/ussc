setwd('..')
pkgdown::clean_site()
devtools::install_github('usstudiescentre/ussc')
pkgdown::build_site()
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(x, y, weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE, results = 'asis', message = F, warning = F)
library(tidyverse)
library(ussc)
library(here)
library(foreign) # to load data
library(knitr) # for tables
library(kableExtra)
library(questionr) # for frequency tables and crosstabs
# Read the data
load(here("analysis/data/survey_long_data.rdata"))
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(questions, ..., weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(questions, ..., weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(question, ..., weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(question, answer, weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(question, answer, weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(question, answer, weight = "weight", type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(question, answer, weight = .$weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(question, answer, weight = .$weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(questions) %>%
cprop(tabs(question, answer, weight = .$weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(questions) %>%
cprop(tabs(question, answer, weight, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(questions) %>%
cprop(tabs(question, answer, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(questions) %>%
cprop(tabs(question, answer, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(questions) %>%
cprop(tabs(question, answer, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(question) %>%
cprop(tabs(question, answer, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(question) %>%
cprop(tabs(as.numeric(question), answer, type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(question) %>%
cprop(tabs(x = as.numeric(question), y = as.numeric(answer), type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>% group_by(question) %>%
cprop(tabs(x = as.numeric(as.character(question)), y = as.numeric(answer), type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
cprop(tabs(x = as.numeric(as.character(question)), type = "percent")) %>%
# dplyr::count(sample, description_us, description_au, answer) %>%
# dplyr::group_by(sample, description_us, description_au) %>%
# dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
# dplyr::select(-n) %>%
# dplyr::ungroup() %>%
# tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
dplyr::count(sample, description_us, description_au, answer, wt = weight) %>%
dplyr::group_by(sample, description_us, description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_survey_question <- function(.data, questions) {
.data %>%
dplyr::select(sample, weight, questions)  %>%
tidyr::gather("question", "answer", -sample, -weight) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(answer) %>%
dplyr::count(sample, description_us, description_au, answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, description_us, description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::spread(sample, proportion) %>%
dplyr::mutate(Difference = `United States` - `Australia`)
}
survey_data %>% prop_survey_question(questions = starts_with("importance_of"))
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos), weight)) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(..., description_au, description_us, answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid, gender)
df <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid, gender)
View(df)
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos), weight, sample)) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au, description_us, answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(!!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
df <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
sample, partyid, gender)
View(df)
df <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
partyid, gender)
View(df)
prop_grouped_survey_question <- function(.data, questions, ...) {
quos <- rlang::enquos(...)
.data %>%
dplyr::select(..., questions, weight, sample)  %>%
tidyr::gather("question", "answer", .dots =  -c(!!!(quos), weight, sample)) %>%
dplyr::left_join(variables_in_long_file %>% select(description_us, description_au, value),
by = c("question" = "value")) %>%
tidyr::drop_na(..., answer) %>%
dplyr::count(sample, ..., description_au, description_us, answer, wt = as.numeric(as.character(weight))) %>%
dplyr::group_by(sample, ..., description_us,  description_au) %>%
dplyr::mutate(proportion = round(n/sum(n)*100, 0)) %>%
dplyr::select(-n) %>%
dplyr::ungroup() %>%
tidyr::unite(subgroup, c(sample, !!!(quos)), sep = "_") %>%
tidyr::spread(subgroup, proportion)
}
View(df)
df <- survey_data %>%
prop_grouped_survey_question(questions = starts_with("sexual_harrassment"),
partyid, gender)
View(df)
devtools::install_github('usstudiescentre/ussc')
pkgdown::clean_site()
pkgdown::build_site()
pkgdown::clean_site()
pkgdown::build_site()
ussc::prop_grouped_survey_question
devtools::install_github('usstudiescentre/ussc')
ussc::prop_grouped_survey_question
devtools::document()
devtools::install_github('usstudiescentre/ussc')
